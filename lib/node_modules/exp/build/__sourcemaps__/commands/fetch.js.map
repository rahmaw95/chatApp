{"version":3,"sources":["commands/fetch.js"],"names":["program","command","description","asyncActionProjectDir","projectDir","options","getPublishInfoAsync","args","username","remotePackageName","experienceName","remoteFullPackageName","distOutputFile","resolve","pushOutputFile","credentialMetadata","platform","getCredentialsForPlatform","certP12","certPassword","pushP12","pushPassword","writeFileSync","Buffer","from","bold","Error","outputFile","credentials","keystore","keystorePassword","keyAlias","keystoreAlias","keyPassword","storeBuf"],"mappings":"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","file":"../../commands/fetch.js","sourcesContent":["/**\n * @flow\n */\n\nimport chalk from 'chalk';\nimport fs from 'fs';\nimport path from 'path';\nimport { Credentials, Exp } from 'xdl';\n\nimport log from '../log';\n\nexport default (program: any) => {\n  program\n    .command('fetch:ios:certs [project-dir]')\n    .description(\n      \"Fetch this project's iOS certificates. Writes to PROJECT_DIR/PROJECT_NAME_(dist|push).p12 and prints passwords to stdout.\"\n    )\n    .asyncActionProjectDir(async (projectDir, options) => {\n      const {\n        args: { username, remotePackageName, remoteFullPackageName: experienceName },\n      } = await Exp.getPublishInfoAsync(projectDir);\n\n      let distOutputFile = path.resolve(projectDir, `${remotePackageName}_dist.p12`);\n      let pushOutputFile = path.resolve(projectDir, `${remotePackageName}_push.p12`);\n\n      const credentialMetadata = {\n        username,\n        experienceName,\n        platform: 'ios',\n      };\n\n      log(`Retreiving iOS certificates for ${experienceName}`);\n\n      try {\n        const {\n          certP12,\n          certPassword,\n          pushP12,\n          pushPassword,\n        } = await Credentials.getCredentialsForPlatform(credentialMetadata);\n\n        log(`Writing distribution cert to ${distOutputFile}...`);\n        fs.writeFileSync(distOutputFile, Buffer.from(certP12, 'base64'));\n        log('Done writing distribution cert to disk.');\n\n        log(`Writing push cert to ${pushOutputFile}...`);\n        fs.writeFileSync(pushOutputFile, Buffer.from(pushP12, 'base64'));\n        log('Done writing push cert to disk.');\n\n        log(`Save these important values as well:\n\nDistribution p12 password: ${chalk.bold(certPassword)}\nPush p12 password:         ${chalk.bold(pushPassword)}\n`);\n      } catch (e) {\n        throw new Error('Unable to fetch credentials for this project. Are you sure they exist?');\n      }\n\n      log('All done!');\n    }, true);\n\n  program\n    .command('fetch:android:keystore [project-dir]')\n    .description(\n      \"Fetch this project's Android keystore. Writes keystore to PROJECT_DIR/PROJECT_NAME.jks and prints passwords to stdout.\"\n    )\n    .asyncActionProjectDir(async (projectDir, options) => {\n      const {\n        args: { username, remotePackageName, remoteFullPackageName: experienceName },\n      } = await Exp.getPublishInfoAsync(projectDir);\n\n      let outputFile = path.resolve(projectDir, `${remotePackageName}.jks`);\n\n      const credentialMetadata = {\n        username,\n        experienceName,\n        platform: 'android',\n      };\n\n      log(`Retreiving Android keystore for ${experienceName}`);\n\n      const credentials: ?AndroidCredentials = await Credentials.getCredentialsForPlatform(\n        credentialMetadata\n      );\n\n      if (!credentials) {\n        throw new Error('Unable to fetch credentials for this project. Are you sure they exist?');\n      }\n\n      const { keystore, keystorePassword, keystoreAlias: keyAlias, keyPassword } = credentials;\n\n      const storeBuf = Buffer.from(keystore, 'base64');\n\n      log(`Writing keystore to ${outputFile}...`);\n      fs.writeFileSync(outputFile, storeBuf);\n      log('Done writing keystore to disk.');\n\n      log(`Save these important values as well:\n\nKeystore password: ${chalk.bold(keystorePassword)}\nKey alias:         ${chalk.bold(keyAlias)}\nKey password:      ${chalk.bold(keyPassword)}\n`);\n\n      log('All done!');\n    }, true);\n};\n"],"sourceRoot":"/Users/brentvatne/universe/dev/exp/src"}